import { encodeData } from "./msgpackr.ts";
import * as base64url from "https://deno.land/std@0.106.0/encoding/base64url.ts";
import { createCoders } from "./utils.ts";
import { CacheRequest } from "./server.ts";
import { Snowflake } from "../src/types/base.ts";

const r = {
  id: "785384884197392384",
  name: "Discordeno(DiscordBotsAPILibrary)",
  icon: "46f50fb412eab14ec455d5cf777154bc",
  description:
    "SupportserverforDiscordeno,DiscordAPIlibraryforDeno,asecureTypeScriptorJavaScriptrunti...",
  splash: "207961ff6c41f119874e10efc602858c",
  discovery_splash: "207961ff6c41f119874e10efc602858c",
  features: [
    "DISCOVERABLE",
    "THREE_DAY_THREAD_ARCHIVE",
    "VANITY_URL",
    "NEWS",
    "NEW_THREAD_PERMISSIONS",
    "PREVIEW_ENABLED",
    "MEMBER_VERIFICATION_GATE_ENABLED",
    "THREADS_ENABLED",
    "WELCOME_SCREEN_ENABLED",
    "ANIMATED_ICON",
    "VERIFIED",
    "ENABLED_DISCOVERABLE_BEFORE",
    "INVITE_SPLASH",
    "COMMUNITY",
  ],
  approximate_member_count: 452,
  approximate_presence_count: 182,
  emojis: [
    {
      name: "discordeno",
      roles: [],
      id: "785403373817823272",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "deno",
      roles: [],
      id: "795269423589228555",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "smart",
      roles: [],
      id: "803649503122161666",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "panda_heart",
      roles: [],
      id: "804772291254681660",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "kitty_wave",
      roles: [],
      id: "804773164583878707",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "kanna_wave",
      roles: [],
      id: "805054424267096124",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "kappa",
      roles: [],
      id: "805055130386956289",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "kappa_lul",
      roles: [],
      id: "805056090780729384",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "this",
      roles: [],
      id: "805501744183640115",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "woah",
      roles: [],
      id: "809851679117279242",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "thonk",
      roles: [],
      id: "810775359854608434",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "ban_hammer",
      roles: [],
      id: "810778944487161856",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "facepalm",
      roles: [],
      id: "810838208174751784",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "blamewolf",
      roles: [],
      id: "814955268123000832",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "pepe_cia",
      roles: [],
      id: "823880750100643840",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "peep_salute",
      roles: [],
      id: "823880765778427926",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_shock",
      roles: [],
      id: "823882084581507082",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_pls",
      roles: [],
      id: "823882085244469308",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_wow",
      roles: [],
      id: "823882085655117834",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_heartbeat",
      roles: [],
      id: "823882085697060884",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "shiba_what",
      roles: [],
      id: "823882085772034108",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_hide",
      roles: [],
      id: "823882085898256395",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_oh",
      roles: [],
      id: "823882086250184704",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_loved",
      roles: [],
      id: "823882086812614666",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_excited",
      roles: [],
      id: "823882087278837792",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_heart",
      roles: [],
      id: "823882089996746783",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_sparkly_eyes",
      roles: [],
      id: "823882091254513675",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shiba_kiss",
      roles: [],
      id: "823882091703697438",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "panda_hype",
      roles: [],
      id: "823884549951193159",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobsip",
      roles: [],
      id: "855134230236889098",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "blobgangsta",
      roles: [],
      id: "855134230316974120",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "gay_blob",
      roles: [],
      id: "855134231458086975",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "shhblob",
      roles: [],
      id: "855134232069537824",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "evilblob",
      roles: [],
      id: "855134233051529266",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "blob_rainbow_trash",
      roles: [],
      id: "855134233901924402",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "abolbpats",
      roles: [],
      id: "855134234644840448",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "ideablob",
      roles: [],
      id: "855134234724925481",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "blurplethumbsdown",
      roles: [],
      id: "855134234992705547",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "abongoblob",
      roles: [],
      id: "855134235895529492",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "ablobpainpats",
      roles: [],
      id: "855134236541059092",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "redblob",
      roles: [],
      id: "855134238008672256",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobpensivesob",
      roles: [],
      id: "855134238629036032",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "angrypoliceblob",
      roles: [],
      id: "855134238659706902",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "Nani",
      roles: [],
      id: "855134239358844958",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "eyesblob",
      roles: [],
      id: "855134241516027944",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobpensivepat",
      roles: [],
      id: "855134241944109077",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "dancingblob",
      roles: [],
      id: "855134242894774342",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobhug",
      roles: [],
      id: "855134243637297182",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "SlowWobble",
      roles: [],
      id: "855134244263165972",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "thinkass",
      roles: [],
      id: "855134244451778600",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "capoowork",
      roles: [],
      id: "855134248603353098",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "hmmmm",
      roles: [],
      id: "855134253310410802",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobrickroll",
      roles: [],
      id: "855134255385804810",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "colorfulblob",
      roles: [],
      id: "855134257948393533",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "Hyper_Blob",
      roles: [],
      id: "855134260641267774",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "kissingblob",
      roles: [],
      id: "855134262898196540",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "hyperblobbut1fps",
      roles: [],
      id: "855134266261766164",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "discordbloblove",
      roles: [],
      id: "855134266773471263",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "blobcontroller",
      roles: [],
      id: "855134267163410452",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "extremeshy",
      roles: [],
      id: "855134267246772285",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "partytime",
      roles: [],
      id: "855134267562393680",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "KannaSip",
      roles: [],
      id: "855135817932472340",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "zeroplease",
      roles: [],
      id: "855135831349395507",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "anime_glasses",
      roles: [],
      id: "855135889051484260",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "PaimonAngry",
      roles: [],
      id: "855136001503526922",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "MewWave",
      roles: [],
      id: "855136220366635029",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "pepeCoffee",
      roles: [],
      id: "855136472234721300",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "Sadge",
      roles: [],
      id: "855136522931666966",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "peepo_cringe",
      roles: [],
      id: "855136692231077898",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "KEKW",
      roles: [],
      id: "855137893151539200",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "press_F",
      roles: [],
      id: "855137983614287894",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "verified_blue",
      roles: [],
      id: "855138172756295760",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "dog_dance",
      roles: [],
      id: "855138551653072906",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "pepeyes",
      roles: [],
      id: "855138591944867850",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
    {
      name: "kannasip",
      roles: [],
      id: "858593982443552810",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "KannaOOF",
      roles: [],
      id: "858594047953338388",
      require_colons: true,
      managed: false,
      animated: true,
      available: true,
    },
    {
      name: "KannaNo",
      roles: [],
      id: "858594112429228052",
      require_colons: true,
      managed: false,
      animated: false,
      available: true,
    },
  ],
  stickers: [
    {
      id: "860265365544108062",
      name: "work",
      tags: "keyboard",
      type: 2,
      format_type: 2,
      description: null,
      asset: "",
      available: true,
      guild_id: "785384884197392384",
    },
  ],
  banner: null,
  owner_id: "130136895395987456",
  application_id: null,
  region: "europe",
  afk_channel_id: null,
  afk_timeout: 300,
  system_channel_id: "785384884197392387",
  widget_enabled: true,
  widget_channel_id: "785388012150063124",
  verification_level: 1,
  roles: [
    {
      id: "785384884197392384",
      name: "@everyone",
      permissions: "1067403562561",
      position: 0,
      color: 0,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "786888595436339230",
      name: "Core",
      permissions: "8052408278",
      position: 15,
      color: 2139379,
      hoist: true,
      managed: false,
      mentionable: true,
      icon: null,
    },
    {
      id: "793198301397647370",
      name: "Admin",
      permissions: "6442450952",
      position: 16,
      color: 15158332,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "812063239793279026",
      name: "ServerBooster",
      permissions: "4294983936",
      position: 7,
      color: 16023551,
      hoist: false,
      managed: true,
      mentionable: false,
      icon: null,
      tags: { premium_subscriber: null },
    },
    {
      id: "813457028725866536",
      name: "hoti",
      permissions: "0",
      position: 11,
      color: 16741495,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "818932660960362566",
      name: "Bot",
      permissions: "8589803480",
      position: 14,
      color: 15844367,
      hoist: false,
      managed: false,
      mentionable: true,
      icon: null,
    },
    {
      id: "831186619847540758",
      name: "cooltri",
      permissions: "0",
      position: 12,
      color: 9820078,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "831581731277897781",
      name: "ProBot✨",
      permissions: "2080374975",
      position: 1,
      color: 0,
      hoist: false,
      managed: true,
      mentionable: false,
      icon: null,
      tags: { bot_id: "282859044593598464" },
    },
    {
      id: "837009996771229776",
      name: "DiscordenoBot",
      permissions: "2184302144",
      position: 3,
      color: 15105570,
      hoist: true,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "838459522922184765",
      name: "Contributors",
      permissions: "0",
      position: 6,
      color: 16029852,
      hoist: true,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "839496448395182091",
      name: "shrimpy",
      permissions: "8",
      position: 2,
      color: 0,
      hoist: false,
      managed: true,
      mentionable: false,
      icon: null,
      tags: { bot_id: "785137289072082965" },
    },
    {
      id: "842013095077609473",
      name: "PenguBot",
      permissions: "0",
      position: 5,
      color: 1752220,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "842041074817040394",
      name: "OG",
      permissions: "0",
      position: 8,
      color: 14862123,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "844970369043529769",
      name: "Proficient",
      permissions: "0",
      position: 9,
      color: 6019044,
      hoist: true,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "851142231666851882",
      name: "DeletedRole",
      permissions: "0",
      position: 10,
      color: 15277667,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "851562792972845076",
      name: "University",
      permissions: "103079215104",
      position: 4,
      color: 15105570,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
    {
      id: "864391546312982530",
      name: "Mod",
      permissions: "105256067078",
      position: 13,
      color: 5229165,
      hoist: false,
      managed: false,
      mentionable: true,
      icon: null,
    },
    {
      id: "880111720591409303",
      name: "Devi",
      permissions: "8",
      position: 1,
      color: 0,
      hoist: false,
      managed: true,
      mentionable: false,
      icon: null,
      tags: { bot_id: "830361895559102474" },
    },
    {
      id: "883436499931123742",
      name: "Muted",
      permissions: "0",
      position: 1,
      color: 0,
      hoist: false,
      managed: false,
      mentionable: false,
      icon: null,
    },
  ],
  default_message_notifications: 1,
  mfa_level: 0,
  explicit_content_filter: 2,
  max_presences: null,
  max_members: 250000,
  max_video_channel_users: 25,
  vanity_url_code: "ddeno",
  premium_tier: 1,
  premium_subscription_count: 7,
  system_channel_flags: 0,
  preferred_locale: "en-US",
  rules_channel_id: "785388012150063124",
  public_updates_channel_id: "792215444106903562",
  nsfw: false,
  nsfw_level: 0,
  channels: [
    {
      id: "785384884197392385",
      type: 4,
      name: "Community",
      position: 1,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "1024", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "785384884197392387",
      type: 0,
      name: "general",
      position: 3,
      topic: "TalkaboutDiscordeno!",
      guildID: "785384884197392384",
      lastMessageID: "886275313733107732",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "785384884197392385",
      lastPinTimestamp: 1623427968000,
      permissionOverwrites: [
        {
          id: "785384884197392384",
          type: 0,
          allow: "1024",
          deny: "2147483648",
        },
        {
          id: "837009996771229776",
          type: 0,
          allow: "1024",
          deny: "2147559488",
        },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "785388012150063124",
      type: 0,
      name: "readme",
      position: 0,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "849348091270266921",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "785405870238334976",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        {
          id: "785384884197392384",
          type: 0,
          allow: "1024",
          deny: "103079217152",
        },
        { id: "837009996771229776", type: 0, allow: "0", deny: "3072" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "785401855407947797",
      type: 0,
      name: "help",
      position: 7,
      topic:
        "DenoandDiscordenorelatedquestionsonly\n\n-Discordeno:https://github.com/discordeno/discordeno",
      guildID: "785384884197392384",
      lastMessageID: "886109864068251699",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524581142822943",
      lastPinTimestamp: 1618949880000,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "785405870238334976",
      type: 4,
      name: "Information",
      position: 0,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "1024", deny: "2048" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "3072" },
      ],
      nsfw: false,
    },
    {
      id: "785406107912634399",
      type: 5,
      name: "announcements",
      position: 1,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "870377207736971375",
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: "785405870238334976",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        {
          id: "785384884197392384",
          type: 0,
          allow: "34359739392",
          deny: "2048",
        },
        { id: "837009996771229776", type: 0, allow: "0", deny: "3072" },
      ],
      nsfw: false,
    },
    {
      id: "785413780208615444",
      type: 0,
      name: "github-updates",
      position: 2,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886266027552419920",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "785405870238334976",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "1024", deny: "2048" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "3072" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "785494400209256449",
      type: 0,
      name: "dev",
      position: 19,
      topic: "Discordeno-relateddevelopmentdiscussions―suggestions,ideas,etc.",
      guildID: "785384884197392384",
      lastMessageID: "879491583261683712",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "844995971318415380",
      lastPinTimestamp: 1621317044000,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "3072" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "791354036804648965",
      type: 2,
      name: "classes-attempt-2",
      position: 0,
      bitrate: 64000,
      rtc_region: null,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: 0,
      rateLimitPerUser: undefined,
      parentID: "843525288285306901",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "1024", deny: "0" },
      ],
      nsfw: false,
    },
    {
      id: "792215444106903562",
      type: 0,
      name: "og-only",
      position: 14,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886214108712693781",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "807859766969368596",
      lastPinTimestamp: 1622308640000,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1024" },
        { id: "786888595436339230", type: 0, allow: "1024", deny: "0" },
        { id: "842041074817040394", type: 0, allow: "1024", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "806947972004839444",
      type: 0,
      name: "spam-and-bots",
      position: 4,
      topic: "Playaroundwiththebotsotherpeoplehavemade.",
      guildID: "785384884197392384",
      lastMessageID: "886276020100026378",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "785384884197392385",
      lastPinTimestamp: 1619890237000,
      permissionOverwrites: [
        { id: "719912970829955094", type: 1, allow: "8192", deny: "0" },
        { id: "745734059992547408", type: 1, allow: "8192", deny: "0" },
        { id: "785384884197392384", type: 0, allow: "1024", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "807859766969368596",
      type: 4,
      name: "Internal",
      position: 5,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
      ],
      nsfw: false,
    },
    {
      id: "833381042412322896",
      type: 0,
      name: "showcase",
      position: 6,
      topic:
        "ShowoffwhatyouhavebuiltwithDiscordeno!\nIfyoufindaprojectthat'snotbuiltwithDiscordeno...",
      guildID: "785384884197392384",
      lastMessageID: "886109855369265162",
      userLimit: undefined,
      rateLimitPerUser: 10,
      parentID: "785384884197392385",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "1024", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "833381204945666108",
      type: 0,
      name: "introductions",
      position: 5,
      topic: "Welcometotheserver!Feelfreetointroduceyourself!",
      guildID: "785384884197392384",
      lastMessageID: "886109845420388352",
      userLimit: undefined,
      rateLimitPerUser: 600,
      parentID: "785384884197392385",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "1024", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "838820989868965951",
      type: 0,
      name: "hackathon-ideas",
      position: 8,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886109871785791500",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524581142822943",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "842040245834219571",
      type: 0,
      name: "pengu-bot",
      position: 15,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "868020579834425415",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "807859766969368596",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "842013095077609473", type: 0, allow: "1024", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "843108229100601355",
      type: 0,
      name: "rango",
      position: 9,
      topic:
        "AdvanceModularFrameworkforDiscordenobyClimactic.co|OfficialRepository:https://github.com/T...",
      guildID: "785384884197392384",
      lastMessageID: "886109899342360618",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524761841958983",
      lastPinTimestamp: 1622138596000,
      permissionOverwrites: [
        { id: "136549806079344640", type: 1, allow: "805314576", deny: "0" },
        { id: "785384884197392384", type: 0, allow: "1024", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "843521022887985212",
      type: 2,
      name: "code",
      position: 2,
      bitrate: 64000,
      rtc_region: null,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: 0,
      rateLimitPerUser: undefined,
      parentID: "843525288285306901",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "843524581142822943",
      type: 4,
      name: "coding",
      position: 2,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "843524761841958983",
      type: 4,
      name: "libraries",
      position: 3,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "843525288285306901",
      type: 4,
      name: "voice",
      position: 4,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "843525500970467388",
      type: 0,
      name: "no-mic",
      position: 13,
      topic: "Youdon'thaveamic?Noproblemyouhaveakeyboard!",
      guildID: "785384884197392384",
      lastMessageID: "886109957508972565",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843525288285306901",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "844995971318415380",
      type: 4,
      name: "archived",
      position: 6,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "849677152910573599",
      type: 0,
      name: "university",
      position: 11,
      topic:
        "https://github.com/discordeno/university\nThisisaClassbasedlibrarytryingtoimplementtheeffi...",
      guildID: "785384884197392384",
      lastMessageID: "886109954396807278",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524761841958983",
      lastPinTimestamp: 1629211917000,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "851444409819725824",
      type: 0,
      name: "typicalbot",
      position: 16,
      topic: "GitHub:https://github.com/typicalbot/typicalbot-deno",
      guildID: "785384884197392384",
      lastMessageID: "875058692544921621",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "807859766969368596",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "176610059684544512", type: 1, allow: "805307408", deny: "0" },
        { id: "187342661060001792", type: 1, allow: "805307408", deny: "0" },
        { id: "785384884197392384", type: 0, allow: "0", deny: "1024" },
        { id: "786888595436339230", type: 0, allow: "1024", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "852200618361487360",
      type: 0,
      name: "natico",
      position: 10,
      topic:
        "GitHub:https://github.com/naticoo/framework\n/x/:https://deno.land/x/natico\nDocs:https://naticoo.g...",
      guildID: "785384884197392384",
      lastMessageID: "886109891113140284",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524761841958983",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "853671100416524318",
      type: 0,
      name: "admin",
      position: 18,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "880079497091743805",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "807859766969368596",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "854477458211602452",
      type: 0,
      name: "nodejs",
      position: 12,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886109955852210216",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524761841958983",
      lastPinTimestamp: 1623794071000,
      permissionOverwrites: [
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "855224651348967444",
      type: 13,
      name: "Ask-Me-Anything",
      position: 1,
      topic: null,
      bitrate: 64000,
      rtc_region: null,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: 10000,
      rateLimitPerUser: undefined,
      parentID: "843525288285306901",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "4294967296", deny: "0" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
      ],
      nsfw: false,
    },
    {
      id: "861266612224524298",
      type: 0,
      name: "server-stats",
      position: 17,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "868235445430001764",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "807859766969368596",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "98822055402688512", type: 1, allow: "1024", deny: "0" },
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "864395125018066974",
      type: 4,
      name: "Logs",
      position: 7,
      guildID: "785384884197392384",
      lastMessageID: undefined,
      userLimit: undefined,
      rateLimitPerUser: undefined,
      parentID: null,
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "864391546312982530", type: 0, allow: "1049600", deny: "10240" },
      ],
      nsfw: false,
    },
    {
      id: "864395796618936320",
      type: 0,
      name: "automod",
      position: 21,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "864398106652311582",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "864395125018066974",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "864391546312982530", type: 0, allow: "1049600", deny: "10240" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "864396315714912287",
      type: 0,
      name: "mod",
      position: 22,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886118303637078037",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "864395125018066974",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "864391546312982530", type: 0, allow: "1049600", deny: "10240" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "864396978426216458",
      type: 0,
      name: "public",
      position: 20,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "864398353486970881",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "864395125018066974",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "103080265728" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: true,
    },
    {
      id: "864400188193374209",
      type: 0,
      name: "messages",
      position: 23,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "886235363927031819",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "864395125018066974",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1049600" },
        { id: "786888595436339230", type: 0, allow: "1049600", deny: "0" },
        { id: "864391546312982530", type: 0, allow: "1049600", deny: "10240" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "866733401577881621",
      type: 0,
      name: "invitetracking",
      position: 24,
      topic: "invitetracking",
      guildID: "785384884197392384",
      lastMessageID: "886069437554384957",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "864395125018066974",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "1024" },
        { id: "798565359006253077", type: 1, allow: "2048", deny: "0" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
    {
      id: "881991954676715653",
      type: 0,
      name: "discord-api-docs",
      position: 25,
      topic: null,
      guildID: "785384884197392384",
      lastMessageID: "885231622025256980",
      userLimit: undefined,
      rateLimitPerUser: 0,
      parentID: "843524581142822943",
      lastPinTimestamp: undefined,
      permissionOverwrites: [
        { id: "785384884197392384", type: 0, allow: "0", deny: "2048" },
        { id: "837009996771229776", type: 0, allow: "0", deny: "1024" },
        { id: "883436499931123742", type: 0, allow: "0", deny: "2099264" },
      ],
      nsfw: false,
    },
  ],
};

const coders = createCoders("bz5shaoGZAX6KgWgBARsc3HIOWjSgrGT4KkM7ieTEjc=");

const set = await fetch("http://127.0.0.1:7252", {
  body: coders.encode({
    type: "get",
    table: "guilds",
    key: 123n,
    data: { foo: "bar" },
  }),
  method: "POST",
  headers: {
    Authorization: "FOO_BAR",
  },
}).then(async (res) => coders.decode(await res.text()));

console.log({ set });

async function sendRequest<T>(request: CacheRequest) {
  return (await fetch("http://127.0.0.1:7252", {
    body: coders.encode(request),
    method: "POST",
    headers: {
      Authorization: "FOO_BAR",
    },
  }).then(async (res) => coders.decode(await res.text()))) as Promise<T>;
}

export function createClientTable<T>(table: TableNames): any {
  return {
    clear: async (): Promise<void> => {
      await sendRequest({ type: "clear", table });
    },
    delete: async (key: Snowflake) =>
      await sendRequest<boolean>({ type: "delete", table, key }),
    has: async (key: Snowflake) =>
      await sendRequest<boolean>({ type: "has", table, key }),
    size: async () => await sendRequest<number>({ type: "size", table }),
    set: async (key: Snowflake, data: T) =>
      await sendRequest<boolean>({ type: "set", table, key, data }),
    get: async (key: Snowflake) =>
      await sendRequest<T>({ type: "get", table, key }),
    // forEach: (callback) => table.forEach(callback),
    // filter: (callback) => table.filter(callback),
  };
}

type TableNames =
  | "channels"
  | "users"
  | "guilds"
  | "messages"
  | "presences"
  | "threads"
  | "unavailableGuilds";
